import{r as p,j as e,c as R,R as V}from"./client-BW4HFQ8H.js";const v=(t,s)=>t.reduce((n,a)=>s>=a.quantity?Math.max(n,a.rate):n,0),L=t=>t.discounts.length>0?`최대 ${(v(t.discounts,1)*100).toFixed(0)}% 할인`:null,O=t=>{const{product:s,quantity:n}=t;return v(s.discounts,n)},B=(t,s)=>s?s.discountType==="amount"?Math.max(0,t-s.discountValue):t*(1-s.discountValue/100):t,k=t=>t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`,Q=t=>{const{product:s,quantity:n}=t,a=s.price*n,c=v(s.discounts,n);return Math.round(a*(1-c))},U=(t,s)=>{const n=t.reduce((o,d)=>o+d.product.price*d.quantity,0),a=t.reduce((o,d)=>o+Q(d),0),c=B(a,s);return{totalBeforeDiscount:Math.round(n),totalAfterDiscount:Math.round(c),totalDiscount:Math.round(n-c)}},w=(t,s,n)=>t.map(a=>{if(a.product.id!==s)return a;if(n<=0)return null;const c=Math.min(n,a.product.stock);return{...a,quantity:c}}).filter(a=>a!==null),_=(t,s)=>{const n=s.find(a=>a.product.id===t.id);return t.stock-((n==null?void 0:n.quantity)||0)},z=()=>{const[t,s]=p.useState([]),[n,a]=p.useState(null);return{cart:t,addToCart:l=>{const i=t.find(x=>x.product.id===l.id),m=t.find(x=>x.product.id===l.id);((m==null?void 0:m.quantity)||0)>=l.stock||s(i?x=>w(x,l.id,i.quantity+1):x=>[...x,{product:l,quantity:1}])},removeFromCart:l=>{s(i=>i.filter(m=>m.product.id!==l))},updateQuantity:(l,i)=>{s(m=>w(m,l,i))},applyCoupon:l=>{a(l)},calculateTotal:()=>U(t,n),selectedCoupon:n}},G=t=>{const[s,n]=p.useState(t);return{coupons:s,addCoupon:c=>{n(o=>[...o,c])}}},H=t=>{const[s,n]=p.useState(t);return{products:s,updateProduct:o=>{n(d=>d.map(r=>r.id===o.id?o:r))},addProduct:o=>{n(d=>[...d,o])}}},b=t=>`${t.toLocaleString()}원`,J=({cartItem:t,updateQuantity:s,removeFromCart:n,getDiscountAppliedDisplay:a,getMaxApplicableDiscount:c})=>{const o=c(t),d=a(o);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[b(t.product.price)," x ",t.quantity,o>0&&e.jsx("span",{className:"text-green-600 ml-1",children:d})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>s(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",disabled:t.quantity<=1,children:"-"}),e.jsx("button",{onClick:()=>s(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>n(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]})},K=({cart:t,updateQuantity:s,removeFromCart:n,getDiscountAppliedDisplay:a,getMaxApplicableDiscount:c})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-2",children:t.map(o=>e.jsx(J,{cartItem:o,updateQuantity:s,removeFromCart:n,getDiscountAppliedDisplay:a,getMaxApplicableDiscount:c},o.product.id))})}),W=({totalBeforeDiscount:t,totalAfterDiscount:s,totalDiscount:n})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",b(t)]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",b(n)]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",b(s)]})]})]})}),X=({coupons:t,applyCoupon:s,selectedCoupon:n,formatCouponDisplay:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:c=>{const o=parseInt(c.target.value),d=!isNaN(o)&&o>=0?t[o]:null;s(d)},className:"w-full p-2 border rounded mb-2",value:n?t.findIndex(c=>c.code===n.code):"",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((c,o)=>e.jsxs("option",{value:o,children:[c.name," - ",a(c)," "]},c.code))]}),n&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",n.name,"(",a(n)," 할인)"]})]}),Y=({product:t,cart:s,addToCart:n})=>{const a=_(t,s),c=d=>d>0?"text-green-600":"text-red-600",o=d=>d>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed";return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsx("span",{className:"text-gray-600",children:b(t.price)})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${c(a)}`,children:["재고: ",a,"개"]}),t.discounts.length>0&&e.jsx("span",{className:"ml-2 font-medium text-blue-600",children:L(t)})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((d,r)=>e.jsx("li",{children:`${d.quantity}개 이상: ${(d.rate*100).toFixed(0)}% 할인`},r))}),e.jsx("button",{onClick:()=>n(t),className:`w-full px-3 py-1 rounded ${o(a)}`,disabled:a<=0,children:a>0?"장바구니에 추가":"품절"})]},t.id)},Z=({products:t,cart:s,addToCart:n})=>e.jsx("div",{className:"space-y-2",children:t.map(a=>e.jsx(Y,{product:a,cart:s,addToCart:n},a.id))}),ee=({products:t,coupons:s})=>{const{cart:n,addToCart:a,removeFromCart:c,updateQuantity:o,applyCoupon:d,calculateTotal:r,selectedCoupon:u}=z(),{totalBeforeDiscount:l,totalAfterDiscount:i,totalDiscount:m}=r(),g=x=>x>0?`(${(x*100).toFixed(0)}% 할인 적용)`:"";return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx(Z,{products:t,cart:n,addToCart:a})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(K,{cart:n,removeFromCart:c,updateQuantity:o,getDiscountAppliedDisplay:g,getMaxApplicableDiscount:O}),e.jsx(X,{coupons:s,applyCoupon:d,selectedCoupon:u,formatCouponDisplay:k}),e.jsx(W,{totalBeforeDiscount:l,totalAfterDiscount:i,totalDiscount:m})]})]})]})},te=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],se=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],C={quantity:0,rate:0},P={name:"",code:"",discountType:"percentage",discountValue:0},ne={name:"",price:0,stock:0,discounts:[]},ae=t=>{const[s,n]=p.useState(P);return{newCoupon:s,handleCouponChange:(o,d)=>{n(r=>({...r,[o]:d}))},handleAddCoupon:()=>{t(s),n(P)}}},de=t=>{const[s,n]=p.useState(C);return{newDiscount:s,handleAddDiscount:d=>{const r={...d,discounts:[...d.discounts,s]};return t(r),n(C),r},handleRemoveDiscount:(d,r)=>{const u=d.discounts.filter((i,m)=>m!==r),l={...d,discounts:u};return t(l),l},handleDiscountChange:(d,r)=>{n(u=>({...u,[d]:d==="rate"?r/100:r}))}}},y={...ne,id:"",discounts:[]},oe=t=>{const[s,n]=p.useState(!1),[a,c]=p.useState(y);return{showNewProductForm:s,newProduct:a,handleProductFieldChange:(u,l)=>{c(i=>({...i,[u]:typeof l=="string"&&u!=="name"?parseInt(l)||0:l}))},handleAddNewProduct:()=>{const u={...a,id:Date.now().toString()};t(u),c(y),n(!1)},toggleNewProductForm:()=>{n(u=>!u),s||c(y)}}},ce=t=>{const[s,n]=p.useState(null);return{editingProduct:s,setEditingProduct:n,handleEditProduct:d=>{n({...d})},handleProductFieldUpdate:(d,r,u)=>{(s==null?void 0:s.id)===d&&n({...s,[r]:u})},handleEditComplete:()=>{s&&(t(s),n(null))}}},re=({newCoupon:t,handleCouponChange:s,handleAddCoupon:n,coupons:a,formatCouponDisplay:c})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:o=>s("name",o.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:o=>s("code",o.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:o=>s("discountType",o.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:o=>s("discountValue",parseInt(o.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:a.map((o,d)=>e.jsxs("div",{"data-testid":`coupon-${d+1}`,className:"bg-gray-100 p-2 rounded",children:[o.name," (",o.code,"):",c(o)," 할인"]},d))})]})]})]}),le=({newProduct:t,onFieldChange:s,onAddProduct:n})=>{const a=t||{name:"",price:0,stock:0};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:a.name,onChange:c=>s("name",c.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:a.price,onChange:c=>s("price",parseInt(c.target.value)||0),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:a.stock,onChange:c=>s("stock",parseInt(c.target.value)||0),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})})},ie=({editingProduct:t,newDiscount:s,handleRemoveDiscount:n,handleDiscountChange:a,handleAddDiscount:c,setEditingProduct:o})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),t.discounts.map((d,r)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[d.quantity,"개 이상 구매 시 ",d.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>{const u=n(t,r);o(u)},className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},r)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:s.quantity,onChange:d=>a("quantity",parseInt(d.target.value)),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:s.rate*100,onChange:d=>a("rate",parseInt(d.target.value)),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>{if(t){const d=c(t);o(d)}},className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),ue=({product:t,editingProduct:s,handleEditProduct:n,handleProductFieldUpdate:a,handleEditComplete:c,newDiscount:o,handleRemoveDiscount:d,handleDiscountChange:r,handleAddDiscount:u,setEditingProduct:l})=>e.jsx("div",{className:"mt-2",children:s&&s.id===t.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:s.name,onChange:i=>a(t.id,"name",i.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"number",value:s.price,onChange:i=>a(t.id,"price",parseInt(i.target.value)),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"number",value:s.stock,onChange:i=>a(t.id,"stock",parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx(ie,{editingProduct:s,newDiscount:o,handleRemoveDiscount:d,handleDiscountChange:r,handleAddDiscount:u,setEditingProduct:l}),e.jsx("button",{onClick:c,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[t.discounts.map((i,m)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[i.quantity,"개 이상 구매 시 ",i.rate*100,"% 할인"]})},m)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>n(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})}),me=({products:t,coupons:s,onProductUpdate:n,onProductAdd:a,onCouponAdd:c})=>{const[o,d]=p.useState(new Set),{editingProduct:r,setEditingProduct:u,handleEditProduct:l,handleProductFieldUpdate:i,handleEditComplete:m}=ce(n),{newCoupon:g,handleCouponChange:x,handleAddCoupon:D}=ae(c),{newDiscount:A,handleAddDiscount:S,handleRemoveDiscount:T,handleDiscountChange:q}=de(n),{showNewProductForm:f,newProduct:F,handleProductFieldChange:M,handleAddNewProduct:I,toggleNewProductForm:E}=oe(a),$=h=>{d(N=>{const j=new Set(N);return j.has(h)?j.delete(h):j.add(h),j})};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:E,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:f?"취소":"새 상품 추가"}),f&&e.jsx(le,{newProduct:F,onFieldChange:M,onAddProduct:I}),e.jsx("div",{"data-testid":"product-list",className:"space-y-2",children:t.map((h,N)=>e.jsxs("div",{"data-testid":`product-${N+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>$(h.id),className:"w-full text-left font-semibold",children:[h.name," - ",h.price,"원 (재고: ",h.stock,")"]}),o.has(h.id)&&e.jsx(ue,{product:h,editingProduct:r,handleEditProduct:l,handleProductFieldUpdate:i,handleEditComplete:m,newDiscount:A,handleRemoveDiscount:T,handleDiscountChange:q,handleAddDiscount:S,setEditingProduct:u})]},h.id))})]}),e.jsx(re,{newCoupon:g,handleCouponChange:x,handleAddCoupon:D,coupons:s,formatCouponDisplay:k})]})]})},xe=()=>{const{products:t,updateProduct:s,addProduct:n}=H(te),{coupons:a,addCoupon:c}=G(se),[o,d]=p.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>d(!o),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:o?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:o?e.jsx(me,{products:t,coupons:a,onProductUpdate:s,onProductAdd:n,onCouponAdd:c}):e.jsx(ee,{products:t,coupons:a})})]})};R.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(xe,{})}));
